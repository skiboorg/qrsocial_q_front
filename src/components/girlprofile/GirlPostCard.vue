<template>
  <div class="bottom backblock " >
    <div class="posts flex items-center justify-between">
      <p class="no-margin text-bold">    {{post.title}}  </p>
      <p class="no-margin text-caption text-grey-6">{{ new Date (post.created_at).toLocaleTimeString().split(':')[0]}}:{{ new Date (post.created_at).toLocaleTimeString().split(':')[1]}},
            {{ new Date (post.created_at).toLocaleDateString()}}</p>

    </div>

    <!--    blur-->
    <div class="post" :class="[post.is_vip && !$auth.user.is_vip? 'blur' : '']">

      <div  class="post-title" v-html="post.text"></div>
      <div v-show="post.image" class="user-profile-post__image">
        <img  class="photopost image" :src="post.image" alt="">
      </div>
      <!--      <div  class="stats flex items-center justify-start">-->
      <!--        <q-btn class="q-mr-md"  @click="likeAction(post.id,index)" flat round icon="favorite"/>-->
      <!--        <p class="no-margin" v-if="post.likes[0]">{{post.likes[0].users.length}}</p>-->
      <!--            <p class="no-margin" v-else>0</p>-->
      <!--      </div>-->
      <div v-if="false" class="stats">
        <div class="likecomment">
          <div v-if="post.likes>0" class="like">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M20.1598 4.99997C19.0935 3.94467 17.6851 3.30524 16.1888 3.19705C14.6925 3.08886 13.2068 3.51904 11.9998 4.40997C10.7274 3.46361 9.14378 3.03448 7.56771 3.20901C5.99164 3.38353 4.54023 4.14875 3.50576 5.35055C2.47129 6.55236 1.93061 8.10149 1.99259 9.68598C2.05457 11.2705 2.71461 12.7726 3.83979 13.89L9.83979 19.94C10.4023 20.5018 11.1648 20.8173 11.9598 20.8173C12.7548 20.8173 13.5173 20.5018 14.0798 19.94L20.0798 13.89C20.6707 13.3126 21.1417 12.6242 21.4657 11.8642C21.7897 11.1042 21.9604 10.2877 21.9678 9.4616C21.9752 8.63548 21.8193 7.81603 21.5091 7.05035C21.1988 6.28467 20.7402 5.58786 20.1598 4.99997ZM18.7498 12.46L12.7498 18.46C12.6568 18.5537 12.5462 18.6281 12.4244 18.6789C12.3025 18.7296 12.1718 18.7558 12.0398 18.7558C11.9078 18.7558 11.7771 18.7296 11.6552 18.6789C11.5334 18.6281 11.4228 18.5537 11.3298 18.46L5.32979 12.46C4.54555 11.6583 4.1064 10.5814 4.1064 9.45997C4.1064 8.3385 4.54555 7.26162 5.32979 6.45997C6.12894 5.67096 7.20676 5.22854 8.32979 5.22854C9.45281 5.22854 10.5306 5.67096 11.3298 6.45997C11.4228 6.5537 11.5334 6.62809 11.6552 6.67886C11.7771 6.72963 11.9078 6.75577 12.0398 6.75577C12.1718 6.75577 12.3025 6.72963 12.4244 6.67886C12.5462 6.62809 12.6568 6.5537 12.7498 6.45997C13.5706 5.80686 14.603 5.47869 15.6502 5.53806C16.6975 5.59743 17.6862 6.04018 18.4279 6.78187C19.1696 7.52356 19.6123 8.5123 19.6717 9.55953C19.7311 10.6068 19.4029 11.6392 18.7498 12.46Z" fill="#8994A2"></path>
            </svg>
            <div class="like-num">{{post.likes[0].users.length}}</div>
          </div>
          <div class="comment">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 9C11.8022 9 11.6089 9.05865 11.4444 9.16853C11.28 9.27841 11.1518 9.43459 11.0761 9.61732C11.0004 9.80004 10.9806 10.0011 11.0192 10.1951C11.0578 10.3891 11.153 10.5673 11.2929 10.7071C11.4327 10.847 11.6109 10.9422 11.8049 10.9808C11.9989 11.0194 12.2 10.9996 12.3827 10.9239C12.5654 10.8482 12.7216 10.72 12.8315 10.5556C12.9414 10.3911 13 10.1978 13 10C13 9.73478 12.8946 9.48043 12.7071 9.29289C12.5196 9.10536 12.2652 9 12 9ZM19 2H5C4.20435 2 3.44129 2.31607 2.87868 2.87868C2.31607 3.44129 2 4.20435 2 5V15C2 15.7956 2.31607 16.5587 2.87868 17.1213C3.44129 17.6839 4.20435 18 5 18H16.59L20.29 21.71C20.3834 21.8027 20.4943 21.876 20.6161 21.9258C20.7379 21.9755 20.8684 22.0008 21 22C21.1312 22.0034 21.2613 21.976 21.38 21.92C21.5626 21.845 21.7189 21.7176 21.8293 21.5539C21.9396 21.3901 21.999 21.1974 22 21V5C22 4.20435 21.6839 3.44129 21.1213 2.87868C20.5587 2.31607 19.7956 2 19 2ZM20 18.59L17.71 16.29C17.6166 16.1973 17.5057 16.124 17.3839 16.0742C17.2621 16.0245 17.1316 15.9992 17 16H5C4.73478 16 4.48043 15.8946 4.29289 15.7071C4.10536 15.5196 4 15.2652 4 15V5C4 4.73478 4.10536 4.48043 4.29289 4.29289C4.48043 4.10536 4.73478 4 5 4H19C19.2652 4 19.5196 4.10536 19.7071 4.29289C19.8946 4.48043 20 4.73478 20 5V18.59ZM8 9C7.80222 9 7.60888 9.05865 7.44443 9.16853C7.27998 9.27841 7.15181 9.43459 7.07612 9.61732C7.00043 9.80004 6.98063 10.0011 7.01921 10.1951C7.0578 10.3891 7.15304 10.5673 7.29289 10.7071C7.43275 10.847 7.61093 10.9422 7.80491 10.9808C7.99889 11.0194 8.19996 10.9996 8.38268 10.9239C8.56541 10.8482 8.72159 10.72 8.83147 10.5556C8.94135 10.3911 9 10.1978 9 10C9 9.73478 8.89464 9.48043 8.70711 9.29289C8.51957 9.10536 8.26522 9 8 9ZM16 9C15.8022 9 15.6089 9.05865 15.4444 9.16853C15.28 9.27841 15.1518 9.43459 15.0761 9.61732C15.0004 9.80004 14.9806 10.0011 15.0192 10.1951C15.0578 10.3891 15.153 10.5673 15.2929 10.7071C15.4327 10.847 15.6109 10.9422 15.8049 10.9808C15.9989 11.0194 16.2 10.9996 16.3827 10.9239C16.5654 10.8482 16.7216 10.72 16.8315 10.5556C16.9414 10.3911 17 10.1978 17 10C17 9.73478 16.8946 9.48043 16.7071 9.29289C16.5196 9.10536 16.2652 9 16 9Z" fill="#8994A2"></path>
            </svg>
            <div class="comment-num">{{post.comments.length}}</div>
          </div>
        </div>
        <div  class="view">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11.9999 15.1307C10.2891 15.1307 8.89724 13.7264 8.89724 12.0002C8.89724 10.2741 10.2891 8.86995 11.9999 8.86995C13.7105 8.86995 15.1023 10.2741 15.1023 12.0002C15.1023 13.7264 13.7107 15.1307 11.9999 15.1307Z" fill="#8994A2"></path>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M12.0001 18C7.28847 18 3.20801 13.4778 2 11.9996C3.20646 10.5198 7.27853 6 12.0001 6C16.7113 6 20.7915 10.5213 22 12.0004C20.7935 13.4802 16.7215 18 12.0001 18ZM11.9999 7.3046C9.43386 7.3046 7.34613 9.41122 7.34613 12.0002C7.34613 14.5894 9.43386 16.6958 11.9999 16.6958C14.5659 16.6958 16.6536 14.5894 16.6536 12.0002C16.6536 9.41122 14.5659 7.3046 11.9999 7.3046Z" fill="#8994A2"></path>
          </svg>
          <div class="view-num">17</div>
        </div>
      </div>
      <div class="blurpost">
        <div class="title">VIP帖子，<br>仅限VIP用户</div>
        <div class="btn">升级为VIP</div>
      </div>
    </div>
  </div>

</template>

<script>


export default {
  props:['post','index'],
  data () {
    return {


    }
  },
  methods:{
    async likeAction(post_id,index){
      console.log( JSON.parse(JSON.stringify(this.post.likes[0])))
      if (this.post.likes[0]){
        if  (this.post.likes[0].users.filter(x => x.id === this.$auth.user.id).length > 0){
          console.log('already like')
          await this.$api.post('/api/v1/post/add_remove_like_to_post',{post_id:post_id,action:'delete'})
        }else{
          await this.$api.post('/api/v1/post/add_remove_like_to_post',{post_id:post_id,action:'add'})
        }
      }else{
        await this.$api.post('/api/v1/post/add_remove_like_to_post',{post_id:post_id,action:'add'})
      }

      //await this.getPosts(index)
    },
  }
}
</script>
<style lang="sass">

</style>
